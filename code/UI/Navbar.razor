@* ReSharper disable RedundantUsingDirective *@
@using System
@using Sandbox.UI;
@inherits Panel
@attribute [StyleSheet]

@code
{
    private readonly List<NavSlot> Slots = new List<NavSlot>();
    private Panel NavContainer { get; set; }
    public int TabIndex { get; private set; }
    public Panel WindowContainer { get; set; }

    protected override void OnAfterTreeRender(bool firstTime)
    {
        if (!firstTime) return;
        NavContainer = new Panel(this, "nav");
        WindowContainer = new Panel(this, "window-container");
        Setup();
    }

    private void Setup()
    {
        CreateSlot(0, "home");
        CreateSlot(1, "window");
        CreateSlot(2, "chair");
    }

    public override void OnHotloaded()
    {
        foreach (NavSlot sl in Slots)
        {
            sl.Delete();
        }

        Slots.Clear();
        Setup();
    }

    public void CreateSlot(int id, string icon)
    {
        var slot = new NavSlot();
        slot.WindowContainer = WindowContainer;
        slot.SlotId = id;
        slot.Icon = icon;
        slot.AddEventListener("onclick", () => OnSlotClick(id));
        NavContainer.AddChild(slot);
        Slots.Add(slot);
    }

    private void OnSlotClick(int i = 0)
    {
        Slots[i].OnClick();
    }

    protected override int BuildHash() => HashCode.Combine(Slots.Select(x => x.GetHashCode()));
}