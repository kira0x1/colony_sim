@namespace Kira.UI
@attribute [StyleSheet]
@inherits Panel
@using Sandbox.UI

@if (!IsActive) return;
<root>
    @for (var i = 0; i < Colony.Villagers.Count; i++)
    {
        if (i > 2) break;
        VillagerData c = Colony.Villagers[i];
        <MinimapSymbol ViewPort="@(this)" Villager="@c"></MinimapSymbol>
    }
</root>

@code {
    public bool IsActive { get; set; }
    public ColonyManager Colony { get; set; }
    public Rect ViewRect { get; set; }
    public Vector2 ViewSize = new Vector2(512, 512);
    public Vector2 Position { get; set; } = Vector2.Zero;
    private Vector2 BoxPosition { get; set; }

    public float Width => ViewRect.Width;
    public float Height => ViewRect.Height;
    public Vector2 ScreenOffset { get; set; }

    public override void OnLayout(ref Rect layoutRect)
    {
        base.OnLayout(ref layoutRect);
        BoxPosition = this.Box.Rect.Position;
        ScreenOffset = layoutRect.Center;

        var parentRect = Parent.Box.Rect;

        var rect = this.Box.Rect;
        rect.Width = parentRect.Width;
        rect.Height = parentRect.Height;
        ViewSize = rect.Size;
        this.Box.Rect = rect;
    }

    public Vector2 CalculatePosition(Vector2 position, Rect box)
    {
        Vector2 pos = Vector2.Zero;
        pos += ScreenOffset;
        // pos.x -= box.Width / 2;
        // pos.y += box.Height / 2;
        pos += position;
        return pos;
    }

    protected override int BuildHash() => System.HashCode.Combine(IsActive);
}