@* ReSharper disable RedundantUsingDirective *@

@using Kira.UI
@using Sandbox.UI;
@inherits Panel;

@{
    var cname = "navslot";
    if (SlotId == ActiveId)
    {
        cname += " active";
        if (TabWin.IsValid())
            TabWin.IsActive = true;
    }
    else
    {
        if (TabWin.IsValid())
            TabWin.IsActive = false;
    }
}

<root class="@cname">
    <i>@Icon</i>
</root>

@code
{
    public string Icon { get; set; }
    public int SlotId { get; set; }
    public static int ActiveId { get; set; }
    public BaseNavWindow TabWin { get; set; }
    public Panel WindowContainer { get; set; }

    protected override void OnAfterTreeRender(bool firstTime)
    {
        if (firstTime)
        {
            if (!TabWin.IsValid())
            {
                TabWin = new BasicWindow();
            }
            else
            {
                Log.Info("NOT INVALID");
            }

            WindowContainer.AddChild(TabWin);
        }
    }

    public void OnClick()
    {
        if (ActiveId == SlotId)
        {
            ActiveId = -1;
        }
        else
        {
            ActiveId = SlotId;
        }
    }

    protected override int BuildHash() => System.HashCode.Combine(ActiveId, TabWin?.IsActive);
}